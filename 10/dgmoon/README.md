# 10장 애플리케이션 프로그래밍과 시스템 프로그래밍

애플리케이션 수준 프로그램과 시스템 수준의 프로그램

컴퓨터가 질문을 하고 사용자가 대답을 하여 동물을 맞추는 게임

## 동물 추측 프로그램 버전1 : HTML과 자바스크립트 프로그램

- 애플리케이션 수준의 뼈대
    - HTML, CSS, Javascript를 사용하여 게임 프로그램을 만들었음
- 웹 페이지 본문
    - div 엘리먼트로 지식 트리를 만들고 CSS로 이를 감춤
- 자바스크립트
    - 질문을 하고 대답에 따라 자식 노드로 이동하는 코드 작성
- CSS
    - start-hidden, invisible 클래스를 정의
    - 간단한 CSS는 인라인 스타일 사용도 가능

## 동물 추측 게임 버전2: C 프로그램

- 브라우저는 고수준 가상머신이고 이 가상 머신의 모든 기능은 소프트웨어로 구현됨
    - 하부 구조를 감추면서 빠르고 쉽게 프로그래밍 가능
- C로 작성

- 터미널과 명령줄
  - 
- 프로그램 빌드
    - cc로 빌드
- 터미널과 장치 드라이버
    - 터미널 - 장치 드라이버 | 운영체제 <-시스템 콜 ->
- 문맥 전환
    - 힌 프로그램을 다른 프로그램으로 변경할 때 프로세스 컨텍스트를 저장, 복구해야 함 -> 문맥 전환
        - 문맥 전환은 비용이 큼
        - 엔터를 누르기 전까지 문맥 전환 이뤄지지 않기를 바람
        - 시스템 콜을 사용해 터미널에서 입력을 읽고 싶다는 의사 표시
            - 그 결과로 사용자 프로그램은 슬립 상태가 되고 다른 동작을 수행할 수 있음
            - 물리적 장치와 관련한 처리를 담당하는 장치드라이버는 터미널에 들어오는 문자를 버퍼에 저장하고 사용자 키를 누를 때가 아니라 엔터를 누를 때에만 사용자 프로그램을 깨움
            - 버퍼는 선입 선출 구조(큐)
            - 버퍼링이 꺼져 있는 경우를 로 모드, 켜져있는 경우를 쿡드 모드라고 함
- 표준 I/O
    - 사용자가 문자를 입력할 때마다 시스템 콜을 호출하는 문제를 막기 위해 `표준 입출력`(stdio) 라이브러리가 만들어짐
    - stdio 라리브러리는 버퍼 입력을 지원하고, 시스템 콜을 한번만 사용해 장치 드라이버에서 읽은 데이터를 버퍼에 넣을 수 있음
    - 출력하는 경우 버퍼가 꽉차거나 중요한 문자(새 줄 문자)가 출력 될 때까지 문자가 버퍼에 들어감
    - 파일 특성을 기술하는 것보다 이름을 사용하면 편함
        - open 시스템 콜은 파일 이름을 파일을 참조할 수 있는 핸들이나 파일 디스크립터로 바꿔줌
        - 이 핸들은 close 시스템 콜로 닫을 수 있고, 닫히면 이 핸들을 더 이상 사용할 수 없음
        - stdio 라이브러리는 open, close, fopen, fclose 함수 제공
- 원형 버퍼
    - 큐의 문제 - 원소 빼기(pop) 시 이동 후 복사가 발생
    - 원형 버퍼(원형 큐, 링 버퍼)는 in 화살표가 시계 방향으로 out 화살표를 따라잡기 전까지 큐에 원소를 추가할 수 있음
    - out 화살표가 시계 방향으로 in 화살표를 잡기 전까지 큐에 있는 원소를 제거할 수 있음
- 추상화를 활용한 코드 개선
    - 상태를 저장했다가 그 상태에서 계속 게임을 수행하는 것은 C 프로그램으로 작성하는 것이 더 쉬움
    - C 프로그램에서는 파일 추상화를 통해서 인터페이스를 프로그래머에게 넘김
- 런타임 라이브러리와 표준 입출력
    - C 프로그램 실행하려면 컴파일 후 컴파일된 코드와 stdio 라이브러리등 다른 코드를 링크해야 함
    - C에서 런타임 라이브러리는 crt0 등의 이름으로 스택과 힙을 설정해서 사용할 수 있도록 준비하는 등의 설정을 담당함
    - 런타임 라이브러리는 추가로 터미널 장치 드라이버와 연관된 파일을 하나는 입력을 위해 다른 하나는 출력을 위해 엶
    - stdio 라이브러리는 시스템 파일 디스크립터를 파일 포인터와 연관 시킴
    - 파일 포인터는 버퍼링이나 파일 관리에 필요한 데이터 구조를 가리킴
    - stdio 제공 파일 포인터: stdin, stdout, stderr
        - stdout, stderr은 똑같은 대상으로 데이터보냄
        - stderr는 버퍼를 사용하지 않고 stdout은 버퍼를 사용
        - stdout으로 오류를 보내면 메시지에 버퍼가 들어가기 때문에 프로그램이 중단될 때 표시되지 않을 수 있음
        - stdout, stderr은 똑같은 파일 디스크립터 공유
- 버퍼 오버플로
    - 심각한 프로그래밍 오류
    - gets 함수가 입력이 버퍼 끝을 벗어 나지 않는지 검사하지 않기 때문에 문제가 됨
    - 버퍼 경계를 검사하는 fgets 함수를 사용해야 함
    - 결코 버퍼 크기가 충분히 크다고 가정하지 말 것
- C 프로그램
    - stdio외에도 많은 C 라이브러리들이 있음 ex)string, stdlib 등
    - 노드 구조체를 선언하고 div 대신 새로운 데이터 구조체를 만듦
  