# 입출력과 네트워킹

## 저수준 I/O

### I/O 포트
I/O 포트는 컴퓨터 시스템과 외부 장치를 연결하는 핵심 인터페이스이다. 가장 단순한 형태의 I/O는 CPU가 읽거나 쓸 수 있는 비트에 불과하지만, 이는 복잡한 장치로 진화했다.

AVR 마이크로컨트롤러의 포트 B를 예로 들면, 이는 세 가지 중요한 레지스터로 구성된다. DDRB는 데이터 방향을 결정하고, PORTB는 출력 데이터를 저장하며, PINB는 핀의 값을 읽는다. 이러한 구조는 유연한 I/O 제어를 가능하게 한다.

LED 연결은 I/O 포트 사용의 대표적인 예시이다. LED와 저항을 직렬로 연결하고, 전류를 제한하기 위해 적절한 저항값을 계산해야 한다. 예를 들어, 5V 전원에서 LED에 10mA를 공급하려면 약 350Ω의 저항이 필요하다.

I/O 포트의 각 비트는 개별적으로 제어할 수 있다. 이를 통해 여러 장치를 동시에 효율적으로 제어할 수 있으며, 복잡한 시스템 구현이 가능해진다. 또한, 입력 모드에서는 외부 장치의 상태를 감지할 수 있어 센서 등과의 상호작용도 가능하다.

### 버튼을 눌러라

풀업 저항은 버튼 회로에서 중요한 역할을 한다. 버튼이 눌리지 않은 경우 이 저항이 프로세서의 인터럽트 요청(IRQ, interrupt request) 핀에 연결된 선의 전압을 공급 전압 V까지 올려서 논리 1을 만들어준다. 버튼이 눌리면 저항은 IRQ나 회로가 닿지 않게 V에서 올라오는 전류를 제한하면서 IRQ에 논리 0을 공급한다.

버튼에 연결된 금속 조각이 접점에 닿으면 금속 조각이 이후 잠깐 되튕기며(바운스) 접점에서 떨어진다. 접촉면이 안정될 때까지 이런 되튕김이 여러 번 발생할 수 있다. 버튼을 디바운스(되튕김을 없앨)할 필요가 있다(되튕김이 없는 버튼을 사용할 수도 있지만 그런 버튼은 비싸다).

디바운스하는 간단한 방법은 인터럽트 핸들러에 타이머를 설정하고 그 시간이 지난 뒤 버튼 상태를 감지하는 것이다. 이런 접근 방식을 두 가지 방법으로 설현할 수 있다. 첫 번째는 최초 인터럽트 시 타이머를 설정하는 방법이고, 두 번째는 인터럽트가 발생할 때마다 기존 타이머를 새 타이머로 재설정하는 것이다.

### 빛이 있으라

디스플레이는 컴퓨터 화면부터 알람 시계, 식기 세척기의 작은 창까지 다양한 디지털 기기에서 사용되는 중요한 출력 장치이다. 가장 흔한 유형은 7세그먼트 디스플레이로, 숫자 8 모양으로 배열된 7개의 LED와 소수점용 1개의 LED로 구성된다.

이 디스플레이를 효율적으로 제어하기 위해 공통 캐소드 방식을 사용한다. 이 방식은 모든 LED의 캐소드를 하나로 연결하고 각 애노드에 개별 핀을 할당하여 핀 수를 줄이고 비용을 절감한다. LED를 켜려면 해당 애노드에 높은 전압을 걸어주면 된다.

디스플레이 제어 소프트웨어는 숫자나 문자와 그에 해당하는 LED 세그먼트를 연관시키는 표를 기반으로 작동한다. 여러 개의 디스플레이를 사용할 때는 멀티플렉싱 기법을 활용한다. 이는 애노드는 병렬로 연결하고 각 디스플레이의 캐소드를 개별 제어하는 방식이다.

이 시스템이 효과적으로 작동하는 이유는 인간의 시각적 잔상효과 때문이다. 1/24초보다 빠르게 깜빡이는 빛을 우리 눈은 계속 켜져 있는 것으로 인식한다. 이 원리를 이용해 각 디스플레이를 빠르게 순차적으로 켜고 끄면, 모든 디스플레이가 동시에 켜져 있는 것처럼 보이게 할 수 있다.

### 빛, 동작, 그리고 상호작용

입력 장치인 버튼과 출력 장치인 디스플레이를 결합한 복합 시스템은 멀티플렉싱 기법을 사용하여 제한된 I/O 핀으로 여러 디스플레이를 효율적으로 제어하며, 매트릭스 키패드 구조를 통해 많은 수의 버튼을 적은 수의 핀으로 관리한다. 풀업 저항은 버튼의 안정적인 상태를 유지하는 데 사용되고, 시분할 처리 방식으로 디스플레이 출력과 키패드 스캔을 번갈아 수행하여 두 기능을 동시에 구현한다. 오픈 드레인이나 오픈 컬렉터 출력은 여러 장치를 같은 선에 연결할 때 유용하게 사용된다.

### 밝기 조절

디스플레이의 듀티 사이클을 조정하면 밝기 조정이 가능하다. 켜져 있는 시간의 빈도를 줄임으로서 가능한 것이다.

### 그레이의 2^n 개 그림자 

회전 인코더는 위치나 각도를 측정하는 장치로, 샤프트의 회전을 디지털 신호로 변환하는 데 사용된다. 2비트 로터리 인코더는 4개의 구분된 위치를 표현할 수 있으며, 이는 원형으로 배치된 패턴으로 구현된다.

단순한 이진 코드는 여러 비트가 동시에 변경될 때 오류가 발생할 수 있다. 이를 해결하기 위해 그레이 코드가 사용된다. 그레이 코드의 특징은 인접한 두 값 사이에 항상 1비트만 차이가 난다는 것이다.

그레이 코드를 사용한 로터리 인코더는 기계적 오차에 강하고 정확한 위치 측정이 가능하다. 센서의 위치가 약간 어긋나더라도 올바른 값을 얻을 수 있어 기계적 내성(tolerance)이 향상된다.

그레이 코드는 다양한 비트 수로 확장될 수 있어, 더 많은 위치를 정확하게 인코딩할 수 있다. 이러한 특성으로 인해 그레이 코드를 활용한 로터리 인코더는 다양한 산업 분야에서 정밀한 각도나 위치 측정이 필요한 경우에 널리 사용된다.

### 쿼드러처

쿼드러처는 2비트 그레이 코드를 확장한 위치 측정 방식이다. 이는 대상의 절대적 위치를 알 필요는 없지만 위치가 변했는지와 어떤 방향으로 변했는지를 알 필요가 있는 경우에 유용하다.

쿼드러처 인코딩은 두 개의 신호를 사용하여 위치를 인코딩한다. 이 두 신호는 X와 Y로 표시되며, 90도의 위상차를 가진다. 이는 sin과 cos 함수와 유사한 관계이다.

### 병렬 통신

병렬 통신은 여러 데이터 비트를 동시에 전송하는 방식이다. 이는 한 번에 여러 LED를 제어하는 것과 유사하며, 각 비트에 대해 별도의 선을 사용한다.

IEEE 1284 병렬 포트는 이 방식의 대표적 예로, 프린터나 스캐너 연결에 사용되었다. 8개의 데이터 선을 통해 아스키 문자 코드를 전송한다.

데이터의 유효성을 나타내기 위해 스트로브(strobe) 신호가 사용된다. 이는 수신 측에 데이터가 준비되었음을 알린다.

IDE는 디스크 드라이브와의 통신에 사용된 또 다른 병렬 인터페이스다.

병렬 통신은 많은 I/O 핀과 선을 필요로 하여 비용이 높다. 또한 신호 속도에 제한이 있어, 이를 극복하기 위해 더 많은 선이 필요하다. 

### 직렬 통신

직렬 통신은 데이터를 한 번에 한 비트씩 순차적으로 전송하는 방식이다. 이는 통신 비용을 줄이고 거리에 따른 비용 증가를 최소화한다.

시프트 레지스터를 사용하여 송신자는 비트를 순차적으로 전송하고, 수신자는 이를 재구성한다. 송수신자 간 동기화가 중요하며, 프로토콜을 통해 신호를 데이터로 변환한다.

직렬 통신에서는 마크와 스페이스 신호, 시작 비트와 정지 비트를 사용한다. 전이중 통신이 가능하며, UART 칩이 이를 구현한다.

RS-232, USB, SATA 등 다양한 인터페이스가 직렬 통신을 채택하고 있어, 적은 수의 선으로 효과적인 데이터 전송이 가능하다.

### 파동에 올라타라


### 범용 직렬 버스

USB는 다양한 장치 연결을 위한 표준화된 직렬 통신 방식이다. 1990년대 중반에 등장하여 PS/2, RS-232, 병렬 포트 등을 대체했다. 4개의 선(전력선 2개, 데이터 신호용 연선 2개)을 사용하는 단일 커넥터로 시작했으나, 최신 USB 타입 C는 24개의 선을 사용한다.

USB는 중앙 집중식 구조로, 컨트롤러가 모든 종단점을 관리한다. 데이터는 헤더와 페이로드로 구성된 패킷 형태로 전송된다. 등시성 전송을 지원하여 음향과 비디오 스트리밍이 가능하며, 장치는 필요한 대역폭을 요청할 수 있고 컨트롤러가 이를 관리한다.


## 네트워킹

네트워크는 근거리 네트워크(LAN)와 광역 네트워크(WAN)로 구분된다. LAN은 집이나 사무실 같이 좁은 지역적 영역을 뜻하고, WAN은 더 넓은 지역적 영역을 뜻한다.

초기 네트워크는 전선 네트워크였고, 이후 전화 네트워크로 발전했다. 현대의 전화 네트워크는 회선 교환 방식을 사용한다. 패킷 교환 방식은 통신 내용을 작은 패킷으로 나누어 전송하며, 시간 분할 멀티플렉싱을 사용해 효율적으로 회로를 사용한다.

초기 컴퓨터 네트워크로는 반자동 지상 환경(SAGE)이 있었다. 1960년대부터 LAN을 사용해 실험을 시작했으며, 벨 연구소에서 개발한 UUCP는 1979년 외부 세계로 배포되었다.

ARPANET은 패킷 스위치 방식의 WAN으로, 현대 인터넷의 전신이 되었다. 인터넷은 1990년대에 대중화되었으며, '네트워크의 네트워크'로 여러 LAN을 하나로 연결하는 WAN이다.

### 최근의 LAN

최초의 이더넷은 반이중 시스템이었다. 모든 장치(컴퓨터, 프린터, 카메라 등)가 같은 선에 연결됐다. 각 장치의 네트워크 인터페이스에는 MAC(Media Access Control) 주소라는 유일한 48비트 주소가 부여됐고, 요즘도 여전히 MAC이 쓰인다.

데이터는 약 1,500바이트짜리 프레임이라는 이름의 패킷으로 구성된다. 프레임에는 송신 주소, 수신 주소, 오류 검증 등이 포함된 헤더가 페이로드와 함께 들어간다.

보통 어떤 장치가 이야기하면 그 밖의 장치들은 이것을 들을 수 있다. 하지만 프레임의 MAC 주소가 자신의 주소와 일치하지 않는 장치는 데이터를 무시한다. 모든 장치가 동시에 이야기하면 충돌이 발생하므로, 한 장치가 이야기하는 것을 들은 장치는 아무 말도 하지 않는다.

충돌이 발생하면 랜덤 백오프 후 재시도 방식을 사용한다. 말하고 싶은 장치는 충돌이 발생하면 임의의 시간을 잠깐 기다린 다음 다시 말하려 시도한다.

### 인터넷
인터넷은 여러 계층으로 이뤄진 프로토콜의 집합이다. 이 프로토콜 계층은 물리적 네트워크를 정의하는 아래쪽 계층을 변경해도 위쪽 계층에 영향을 끼치지 않도록 고안됐다. 이런 설계로 인해 인터넷이 선, 전파, 광섬유나 앞으로 등장할 새로운 기술 위에서 작동할 수 있다.
* TCP/IP

TCP/IP는 인터넷이 사용하는 두 가지 프로토콜이다. IP는 패킷을 한 곳에서 다른 곳으로 옮기며, 이 패킷을 데이터그램이라고 부른다. TCP는 IP 위에 만들어졌고 패킷이 제대로 배달됐는지를 확실히 보장해준다. TCP는 마치 수많은 박스를 배송하는 것과 한 택배사에 모든 박스를 배송할 수 없는 경우도 있고, 박스 중 일부는 상황에 따라 같은 날 도착하지 못할 수도 있다는 점과 비슷하다.
* IP 주소

인터넷상의 각 컴퓨터에는 IP 주소라는 유일한 주소가 할당되어 있다. IP 주소 시스템은 계층적인 시스템으로, 주소 중 일부분을 누군가에게 할당하면, 그 누군가는 다시 자신에게 할당된 주소 중 일부 블록을 다른 누군가에게 할당하는 식으로 이뤄진다. 현재는 대부분 IPv4를 사용하지만, 주소 부족으로 IPv6로 나아가고 있는 중이다.
* 도메인 이름 시스템

DNS는 전화번호부와 비슷하다. DNS는 이름을 주소로 바꿔준다. whitehouse.gov라는 이름의 IP 주소가 지금 23.15.93.167이라는 사실을 기억한다. DNS는 휴대폰의 주소록과 같은 일을 한다. 단지 휴대폰 주소록은 어디부터 최신 정보를 유지해야 하지만 DNS는 주소가 바뀌는 경우를 알아서 잘 처리해준다는 점이 다르다.
* 월드 와이드 웹

TCP/IP 위에 만들어진 여러 프로토콜이 있다.SMTP는 전자우편 시스템이 작동하는 기반 프로토콜이다. 가장 많이 사용하는 프로토콜은 HTTP다. HTTP는 하이퍼텍스트 전송 프로토콜의 약자로, 보안이 강화되어 안전하다는 뜻의 형용사 'secure'의 첫 글자인 'S'가 추가된 HTTPS와 더불어 웹 페이지 전송을 책임진다. 웹 브라우저는 웹 서버와 상호작용하는 방법을 정의한다. URL은 웹 브라우저 주소창에 입력하는 웹사이트 주소에 따라 웹 페이지를 열 수 있다.
